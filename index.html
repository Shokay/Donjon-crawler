<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Donjon crawler</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js">
    </script>

    <style type="text/css"> body 
    
        { margin: 0; 
        }
        
    
    </style>
</head>
<body>
    <script type="text/javascript">
    class sceneExemple extends Phaser.Scene{
        constructor(){
        super("sceneExemple");
        }  
        

            preload(){
                //load de toute les images / sprites sheet 

                this.load.image("Phaser_Trou", "assets/SetHole.png");
                this.load.image("Phaser_Salle", "assets/Salle1.png");
                this.load.image("Phaser_Autres", "assets/SetAutre.png");
                this.load.image("MonstreR","assets/mobmc.png");
                this.load.image("AgroZ","assets/ZoneAgro.png");
                this.load.image("BourseHUD","assets/bourse.png");
                this.load.image("PiqueSolo","assets/PiqueSeul.png");  
                this.load.image("TriggerZone","assets/Zonetrigger.png"); 
                this.load.image("PlaquePressionoff","assets/PressurePlat1.png");
                this.load.image("PlaquePressionon","assets/PressurePlat2.png");
                this.load.image("BackPackHUD","assets/backpack.png");   
                this.load.image("BatLoot","assets/lootB.png");   
                this.load.image("RockLoot","assets/lootR.png");
                this.load.image("clénul","assets/clé1.png");
                this.load.image("clédar","assets/clé2.png");
                this.load.image("tapis","assets/Tapis.png");
                this.load.image("CampFireNull","assets/fireplaceNull.png");   
                this.load.image("DropMoney","assets/MoneyDrop.png");
                this.load.image("DonutTexte","assets/DonutTxT.png");
                this.load.image("PizzaTexte","assets/PizzaTxT.png");
                this.load.image("PotionTexte","assets/PotionTxT.png");                                               
                this.load.tilemapTiledJSON("carte", "DonjonMap.json");  
                
                this.load.spritesheet('PersoSprite','assets/spritesheetP.png',
                { frameWidth: 38, frameHeight: 42 });
                this.load.spritesheet('PersoSpriteF','assets/spritesheetPF.png',
                { frameWidth: 38, frameHeight: 42 });
                this.load.spritesheet('AnimBoule1','assets/AnimBullet1.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2D','assets/AnimBullet2D.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2H','assets/bulletspritesheetFH.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2G','assets/bulletspritesheetFG.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2B','assets/bulletspritesheetFB.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('MonstreRA','assets/spritesheetMC.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('MonstreBA','assets/spritesheetMB.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('PVbar','assets/spritesheetPV.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('SpikeA','assets/spritesheetPique.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('FireSprite','assets/firespritesheet.png',
                { frameWidth: 32, frameHeight: 64 });
                this.load.spritesheet('ChestSprite','assets/ChestSpriteSheet.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('MarchandSprite','assets/ShopSpriteSheet.png',
                { frameWidth: 96, frameHeight: 128 });
                this.load.spritesheet('DonutSprite','assets/SpriteSheetDonut.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('PizzaSprite','assets/SpriteSheetPizza.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('PotionSprite','assets/PotionSpriteSheet.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('PotionHUD','assets/SpriteSheetPotionHUD.png',
                { frameWidth: 64, frameHeight: 64 });

                this.load.bitmapFont('carrier_command', 'assets/carrier_command.png', 'assets/carrier_command.xml');

            }  

            
            
        

            create (){
                this.isConnected = false;
                this.directionX=0
                this.directionY=750 * 1
                this.directionTY=1
                this.directionTX=0
                this.haut="upB";
                this.bas="downB";
                this.droite="rightB";
                this.gauche="leftB";
                this.immobileB="staticBB";
                this.immobileH="staticBH";
                this.immobileG="staticBG";
                this.immobileD="staticBD";
                this.invincible=false;
                this.compteur = 60;
                this.HpJoueur=3;
                this.fallV=false;
                this.tailleP=1;
                this.speedconst = 1000;
                this.thune=0;
                this.LootBatV=0;
                this.LootRockV=0;
                this.spawnS1=false;
                this.salle1visit=false;;
                this.spawnS3=false;
                this.salle3visit=false;
                this.spawnS4=false;
                this.salle4visit=false;
                this.spawnS5=false;
                this.salle5visit=false
                this.Plaque1A=false;
                this.Plaque2A=false;
                this.ImagePlaque1="PlaquePressionoff";
                this.ImagePlaque2="PlaquePressionoff";
                this.BulletA="BulletShoot";
                this.feuV=false;
                this.utilisecléV=false;
                this.Getclé = false;
                this.createclé=false;
                this.inZone = false;
                this.OnPotion = false;
                this.createAfficheP=true;
                this.AchatPotion=false;
                this.AchatPizza=false;
                this.AchatDonut=false;
                this.PotionStatus=4;
                this.potionCheck=false;
                this.PotionStatusHUD=3;

                const carteDuNiveau = this.make.tilemap({ key: "carte"});
                
                // importer TileSet 
                        
                const tileset1 = carteDuNiveau.addTilesetImage(
                        "Salle1T",
                        "Phaser_Salle",
                        32,
                        32
                        );  

                const tileset2 = carteDuNiveau.addTilesetImage(
                        "SetHole",
                        "Phaser_Trou",
                        32,
                        32
                        ); 
                        
                const tileset3 = carteDuNiveau.addTilesetImage(
                        "SetAutre",
                        "Phaser_Autres",
                        32,
                        32
                        ); 

                // importer les calques 


                const Calque5 = carteDuNiveau.createLayer(
                        "SalleB",
                        tileset1,
                    ); 

                this.Calque = carteDuNiveau.createLayer(
                        "Blocs",
                        tileset2,
                    );

                 const Calque21 = carteDuNiveau.createLayer(
                        "Decors-1",
                        tileset2,
                    ); 

                const Calque2 = carteDuNiveau.createLayer(
                        "Decors",
                        tileset2,
                    ); 

                const CalqueA = carteDuNiveau.createLayer(
                        "Decors Autres",
                        tileset3,
                    ); 

                const Calque3 = carteDuNiveau.createLayer(
                        "Solid",
                        tileset2,
                    );

                const CalqueSJ = carteDuNiveau.createLayer(
                        "SolidJ",
                        tileset2,
                    ); 

                const CalqueSM = carteDuNiveau.createLayer(
                        "SolidM",
                        tileset2,
                    );    

                const CalqueMort = carteDuNiveau.createLayer(
                        "Mort",
                        tileset2,
                    );

                this.CalquePorte2 = carteDuNiveau.createLayer(
                        "PortesP",
                        tileset1,
                    );

                const CalqueStairs = carteDuNiveau.createLayer(
                        "stair",
                        tileset1,
                    );

                this.BlockZone1Gauche = carteDuNiveau.createLayer(
                        "PorteBlockZ1G",
                        tileset1,
                    );
                    
                this.BlockZone1Droite = carteDuNiveau.createLayer(
                        "PorteBlockZ1D",
                        tileset1,
                    );

                this.BlockZone1Gauche.setCollisionByProperty({ estSolide: true }); 
                this.BlockZone1Gauche.setDepth(3)
                
                this.BlockZone1Droite.setCollisionByProperty({ estSolide: true }); 
                this.BlockZone1Droite.setDepth(3)

                this.CléUtiliser = this.physics.add.image(2239,845,"AgroZ")
                this.CléUtiliser.setSize(50, 50)

                this.DropsRock=this.physics.add.group();
                this.DropsBat=this.physics.add.group();
                this.FireOnG=this.physics.add.group();

                this.SpikeG=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.anims.create({
                    key: 'SpikeAnim',           
                    frames: this.anims.generateFrameNumbers('SpikeA', {start:0,end:16}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.Calque.setDepth(-2)

                carteDuNiveau.getObjectLayer('Spike').objects.forEach((spike) => {
                    // Add new spikes to our sprite group
                    const spikeSprite = this.SpikeG.create(spike.x, spike.y -= 32,'PiqueSolo').setOrigin(0);
                });

                this.SpikeG.playAnimation("SpikeAnim");
                
                this.CampG=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                carteDuNiveau.getObjectLayer('FireCamp').objects.forEach((camps) => {
                    // Add new spikes to our sprite group
                    const CampSprite = this.CampG.create(camps.x, camps.y -= 32,'CampFireNull').setOrigin(0);
                });

                this.Plaque1 = this.physics.add.image(882,1035,"PlaquePressionoff")
                this.Plaque2 = this.physics.add.image(625,1200,"PlaquePressionoff")
                this.Tapis1 = this.add.image(279,263,'tapis');
                this.Tapis2 = this.add.image(304,319,'tapis');
                this.Tapis3 = this.add.image(260,363,'tapis');
                this.DonutItem = this.physics.add.sprite(260,355, 'DonutSprite');
                this.DonutItem.body.setSize(128,64,true)
                this.DonutItem.setOffset(-6, 5)                
                this.PizzaItem = this.physics.add.sprite(279,250, 'PizzaSprite');
                this.PizzaItem.body.setSize(128,64,true)
                this.PizzaItem.setOffset(8, 0)
                this.PotionItem = this.physics.add.sprite(304,300, 'PotionSprite');
                this.PotionItem.body.setSize(128,64,true)
                this.PotionItem.setOffset(8, 15)

                this.player = this.physics.add.sprite(1665,1093, 'PersoSprite');
                this.player.body.setSize(24,12,true)
                this.player.setOffset(8, 28)
                this.player.alpha = 1;  
                Calque3.setCollisionByProperty({ estSolide: true });         //background et plateformes
                CalqueSJ.setCollisionByProperty({ estSolide: true }); 
                CalqueSM.setCollisionByProperty({ estSolide: true }); 
                CalqueMort.setCollisionByProperty({ Tue: true });         //background et plateformes
                this.physics.add.collider(this.player, Calque3);
                this.physics.add.collider(this.player, CalqueSJ);
                this.collidePG=this.physics.add.collider(this.player, this.BlockZone1Gauche);
                this.collidePD=this.physics.add.collider(this.player, this.BlockZone1Droite);
                this.physics.add.collider(this.player, CalqueMort, this.Fall,null,this);
                this.ArgentTxT= this.add.bitmapText(445, 195, 'carrier_command',this.thune,9);
                this.ArgentTxT.setScrollFactor(0);
                this.LootBatTxT= this.add.bitmapText(906, 210, 'carrier_command',this.LootBatV,9);
                this.LootBatTxT.setScrollFactor(0);
                this.LootRockTxT= this.add.bitmapText(890, 250, 'carrier_command',this.LootRockV,9);
                this.LootRockTxT.setScrollFactor(0);
                this.label = this.add.text(460, 195, '(x,y)', { fontFamily: '"Monospace"'});
                this.label.setScrollFactor(0)
                this.Marchand = this.physics.add.sprite(170,290, 'MarchandSprite') ;
                this.Marchand.body.setSize(100,100,true)
                this.Marchand.setOffset(50, 50)
                this.TextePotion = this.physics.add.image(240,280, "PotionTexte");
                this.TextePotion.setScale(0.5)
                this.TextePizza = this.physics.add.image(210,230, "PizzaTexte");
                this.TextePizza.setScale(0.5)
                this.TexteDonut= this.physics.add.image(200,335, "DonutTexte");
                this.TexteDonut.setScale(0.5)

                this.groupeBalles = this.physics.add.group();  
                this.physics.add.collider(this.groupeBalles, Calque3, this.destroy,null,this);

                this.BlocsDS1=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.BlocsDS3=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.BlocsGS2=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.BlocsHS4=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                carteDuNiveau.getObjectLayer('Salle1D').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd1 = this.BlocsDS1.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                carteDuNiveau.getObjectLayer('Salle3D').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd2 = this.BlocsDS3.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                carteDuNiveau.getObjectLayer('Salle2G').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd3 = this.BlocsGS2.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                carteDuNiveau.getObjectLayer('Salle4H').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd4 = this.BlocsHS4.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                this.ChestGD1=this.physics.add.group();
                this.ChestD1 = this.ChestGD1.create(2123,668, "ChestSprite");
                this.ChestD1.body.setSize(150,150,true);

                this.ChestGG1=this.physics.add.group();
                this.ChestG1 = this.ChestGG1.create(267,1082, "ChestSprite");
                this.ChestG1.body.setSize(150,150,true);
                
                this.CoinG=this.physics.add.group();
                this.HealG=this.physics.add.group();

                this.PierresM=this.physics.add.group();
                this.physics.add.collider(this.PierresM, Calque3);
                this.physics.add.collider(this.PierresM, CalqueSJ);
                this.physics.add.collider(this.PierresM, CalqueSM);
                this.PierreM1 = this.PierresM.create(2766,1174, "MonstreR");
                this.PierreM1.setBounce(1);
                this.PierreM2 = this.PierresM.create(2880,1032, "MonstreR");
                this.PierreM2.setBounce(1);
                this.PierreM3 = this.PierresM.create(2523,546, "MonstreR");
                this.PierreM3.setBounce(1);
                this.PierreM4 = this.PierresM.create(2199,751, "MonstreR");
                this.PierreM4.setBounce(1);
                this.PierreM5 = this.PierresM.create(2164,586, "MonstreR");
                this.PierreM5.setBounce(1);
                this.PierreM6 = this.PierresM.create(819,676, "MonstreR");
                this.PierreM6.setBounce(1);
                this.PierreM7 = this.PierresM.create(861,1153, "MonstreR");
                this.PierreM7.setBounce(1);
                this.PierreM8 = this.PierresM.create(1108,256, "MonstreR");
                this.PierreM8.setBounce(1);
                this.PierreM9 = this.PierresM.create(1804,355, "MonstreR");
                this.PierreM9.setBounce(1);

                this.BatM=this.physics.add.group();
                this.physics.add.collider(this.BatM, Calque3);
                this.BatM1 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM2 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM3 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM4 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM5 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM6 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM7 = this.BatM.create(1000000000,1000000000, "MonstreBA");
                this.BatM8 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM9 = this.BatM.create(1000000000,1000000000, "MonstreBA");
                this.BatM10 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM11 = this.BatM.create(1000000000,1000000000, "MonstreBA");       
                
                this.AgroZoneM1 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM1.setSize(224, 224)
                this.AgroZoneM2 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM2.setSize(224, 224)
                this.AgroZoneM3 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM3.setSize(224, 224)
                this.AgroZoneM4 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM4.setSize(224, 224)
                this.AgroZoneM5 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM5.setSize(224, 224)
                this.AgroZoneM6 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM6.setSize(224, 224)
                this.AgroZoneM7 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM7.setSize(224, 224)
                this.AgroZoneM8 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM8.setSize(224, 224)
                this.AgroZoneM9 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM9.setSize(224, 224)

                
                
                this.physics.add.overlap(this.groupeBalles, this.PierresM, this.AttaqueRock, null, this);
                this.physics.add.overlap(this.groupeBalles, this.BatM, this.AttaqueBat, null, this);
                this.physics.add.overlap(this.groupeBalles, this.CampG, this.FireOn, null, this);
                this.physics.add.overlap(this.player, this.BatM, this.MonstreAttaque, null, this);
                this.physics.add.overlap(this.player, this.PierresM, this.MonstreAttaque, null, this);
                this.physics.add.overlap(this.player, this.SpikeG, this.SpikeDegat, null, this);
                this.physics.add.overlap(this.player, this.Plaque1, this.ActivPlaque1, null, this);
                this.physics.add.overlap(this.player, this.Plaque2, this.ActivPlaque2, null, this);
                this.physics.add.overlap(this.player, this.BlocsDS1, this.Salle1SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.BlocsDS3, this.Salle3SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.BlocsGS2, this.Salle4SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.BlocsHS4, this.Salle5SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.DropsBat, this.TakeDropB, null, this);
                this.physics.add.overlap(this.player, this.DropsRock, this.TakeDropR, null, this);
                this.physics.add.overlap(this.player, this.CléUtiliser, this.UseKey, null, this);
                this.physics.add.overlap(this.player, this.CoinG, this.TakeMoney, null, this);
                this.physics.add.overlap(this.player, this.HealG, this.TakeHeal, null, this);
                this.physics.add.overlap(this.player, this.ChestD1, this.LootChestD1, null, this);
                this.physics.add.overlap(this.player, this.ChestG1, this.LootChestG1, null, this);
                this.physics.add.overlap(this.player, this.PotionItem, this.VerifAchatPotion,null, this);
                this.physics.add.overlap(this.player, this.PizzaItem, this.VerifAchatPizza,null, this);
                this.physics.add.overlap(this.player, this.DonutItem, this.VerifAchatDonut,null, this);
                this.physics.add.overlap(this.player, this.Marchand, this.SellItems,null, this);

                this.CalquePorte = carteDuNiveau.createLayer(
                        "portes",
                        tileset1,
                    );
                this.CalquePorte.setDepth(2)

                this.player.setCollideWorldBounds(true);
                this.BourseImage = this.add.image(430,200,'BourseHUD');
                this.BourseImage.setScrollFactor(0);
                this.Pvbarre = this.add.sprite(360,205, 'PVbar');
                this.Pvbarre.setScrollFactor(0);
                this.BackPack = this.add.sprite(890,230, 'BackPackHUD');
                this.BackPack.setScrollFactor(0);
                this.LootBat = this.add.sprite(900,212, 'BatLoot');
                this.LootBat.setScrollFactor(0);
                this.LootRock = this.add.sprite(885,245, 'RockLoot');
                this.LootRock.setScrollFactor(0);
                this.PotionHud = this.add.sprite(1000,1000, 'PotionHUD');
                this.PotionHud.setScrollFactor(0);
                //this.CléDar = this.add.sprite(927,235, 'clédar');
                //this.CléDar.setScrollFactor(0);
                this.Pvbarre.setScale(0.8);
                this.LootBat.setDepth(10);
                this.LootRock.setDepth(10);
                //this.CléDar.setDepth(10);
                this.BackPack.setDepth(10);
                this.label.setDepth(10);
                this.ArgentTxT.setDepth(10);
                this.LootBatTxT.setDepth(11);
                this.LootRockTxT.setDepth(11);
                this.BourseImage.setDepth(10);
                this.Pvbarre.setDepth(10);
                this.PotionHud.setDepth(10);

                this.anims.create({
                    key: 'leftB',           
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:8,end:11}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:16,end:19}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBH',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:28,end:31}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBD',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:20,end:23}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBG',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:24,end:27}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'rightB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:4,end:7}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'downB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:0,end:3}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'upB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:12,end:15}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'BulletShoot',           
                    frames: this.anims.generateFrameNumbers('AnimBoule1', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'leftF',           
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:8,end:11}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFB',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:16,end:19}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFH',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:28,end:31}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFD',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:20,end:23}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFG',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:24,end:27}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'rightF',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:4,end:7}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'downF',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:0,end:3}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'upF',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:12,end:15}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFD',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2D', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFG',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2G', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFB',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2B', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFH',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2H', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'MonstreRockAttack',           
                    frames: this.anims.generateFrameNumbers('MonstreRA', {start:0,end:2}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'MonstreBatAttack',           
                    frames: this.anims.generateFrameNumbers('MonstreBA', {start:0,end:1}),          //creation des animation
                    frameRate: 6,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'HP1',           
                    frames: this.anims.generateFrameNumbers('PVbar', {start:0,end:0}),          //creation des animation
                    frameRate: 6,
                });

                this.anims.create({
                    key: 'HP2',           
                    frames: this.anims.generateFrameNumbers('PVbar', {start:1,end:1}),          //creation des animation
                    frameRate: 6,
                });

                this.anims.create({
                    key: 'HP3',           
                    frames: this.anims.generateFrameNumbers('PVbar', {start:2,end:2}),          //creation des animation
                    frameRate: 6,
                });
                
                this.anims.create({
                    key: 'FireSpriteA',           
                    frames: this.anims.generateFrameNumbers('FireSprite', {start:0,end:2}),          //creation des animation
                    frameRate: 5,
                });

                this.anims.create({
                    key: 'ChestClose',           
                    frames: this.anims.generateFrameNumbers('ChestSprite', {start:0,end:0}),          //creation des animation
                    frameRate: 5,
                });

                this.anims.create({
                    key: 'ChestOpen',           
                    frames: this.anims.generateFrameNumbers('ChestSprite', {start:1,end:1}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'MarchandA',           
                    frames: this.anims.generateFrameNumbers('MarchandSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'DonutA',           
                    frames: this.anims.generateFrameNumbers('DonutSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PizzaA',           
                    frames: this.anims.generateFrameNumbers('PizzaSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionA',           
                    frames: this.anims.generateFrameNumbers('PotionSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionHUDState1',           
                    frames: this.anims.generateFrameNumbers('PotionHUD', {start:0,end:0}),
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionHUDState2',           
                    frames: this.anims.generateFrameNumbers('PotionHUD', {start:1,end:1}),
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionHUDState3',           
                    frames: this.anims.generateFrameNumbers('PotionHUD', {start:2,end:2}),
                    frameRate: 5,
                });

                this.physics.world.setBounds(0, 0, 3200, 1376);
                this.cameras.main.setBounds(0, 0, 3200,1376);
                this.cameras.main.zoom = 2;                  //Camera
                this.cameras.main.startFollow(this.player);  
                this.player.setCollideWorldBounds(true);
                // touches clavier
                this.cursors = this.input.keyboard.createCursorKeys();
                this.keys = this.input.keyboard.addKeys({
                    q:  Phaser.Input.Keyboard.KeyCodes.Q,
                    d:  Phaser.Input.Keyboard.KeyCodes.D,
                    s:  Phaser.Input.Keyboard.KeyCodes.S,
                    z:  Phaser.Input.Keyboard.KeyCodes.Z,
                    a:  Phaser.Input.Keyboard.KeyCodes.A,
                    e:  Phaser.Input.Keyboard.KeyCodes.E,               //importation de touche
                    r:  Phaser.Input.Keyboard.KeyCodes.R,  
                    f:  Phaser.Input.Keyboard.KeyCodes.F
                });
            }

            MonstreAttaque(player){
                if(this.invincible === false){
                        this.invincible = true;
                        this.HpJoueur --;
                        this.player.setTint(0xff0000);
                        this.cameras.main.shake(100, 0.01);
                    }
            }

            Death(){
                this.scene.restart();
                this.haut="upB";
                this.bas="downB";
                this.droite="rightB";
                this.gauche="leftB";
                this.immobile="staticB";
                this.invincible=false
            }

            Fall(){
                if (this.player.direction=='gauche')
                    this.player.x-=30
                if (this.player.direction=='droite')
                    this.player.x+=30
                if (this.player.direction=='haut')
                    this.player.y-=20
                if (this.player.direction=='bas')
                    this.player.y+=30
                this.fallV=true
                this.speedconst=0
            }

            destroy(balle){
                balle.disableBody(true,true)
            }

            tirer(player) {
                // choix de la direction de la balle en fonction de l'ancien ou du déplacement actuel du joueur
                if (player.direction == 'gauche') { 
                    this.directionX=750 * -0.5
                    this.directionY=0
                    this.directionTX=-2
                    this.directionTY=0
                } 
                else if (player.direction == 'droite'){ 
                    this.directionX=750 * 0.5
                    this.directionY=0
                    this.directionTX=2
                    this.directionTY=0
                }
                else if (player.direction == 'haut'){ 
                    this.directionX=0
                    this.directionY=750 * -0.5
                    this.directionTY=-2
                    this.directionTX=0
                }
                else if (player.direction == 'bas'){ 
                    this.directionX=0
                    this.directionY=750 * 0.5
                    this.directionTY=1
                    this.directionTX=0
                }
                
                var balle1 = this.groupeBalles.create(this.player.x + (15 * this.directionTX), this.player.y + (15 * this.directionTY));
                balle1.anims.play(this.BulletA,true);
                balle1.setCollideWorldBounds(true);
                balle1.body.onWorldBounds = true;  
                balle1.body.allowGravity =false;
                balle1.setVelocity(this.directionX, this.directionY); 
            }  
            
            AttaqueRock(balle,Monstreseul){
                Monstreseul.disableBody(true, true);
                balle.disableBody(true,true);
                this.thune+=Math.floor(Math.random() * 20)+1
                this.ArgentTxT.setText(this.thune)
                var DropRock = this.DropsRock.create(Monstreseul.x,Monstreseul.y, "RockLoot");
                DropRock.setScale(0.5)
                DropRock.body.setSize(100,100,true)
            }

            AttaqueBat(balle,Monstreseul){
                Monstreseul.disableBody(true, true);
                balle.disableBody(true,true);
                this.thune+=Math.floor(Math.random() * 20)+1
                this.ArgentTxT.setText(this.thune)
                var DropBat = this.DropsBat.create(Monstreseul.x,Monstreseul.y, "BatLoot");
                DropBat.setScale(0.5)
                DropBat.body.setSize(100,100,true)
            }

            TakeDropB(player,drop){
                console.log("lol")
                drop.destroy()
                this.LootBatV+=1
                this.LootBatTxT.setText(this.LootBatV)
            }

            TakeDropR(player,drop){
                console.log("lol")
                drop.destroy()
                this.LootRockV+=1
                this.LootRockTxT.setText(this.LootRockV)
            }
            VerifAchatPotion(){
                if(this.keys.f.isDown && this.thune>=150 && this.AchatPotion==false){
                    this.thune-=150
                    this.ArgentTxT.setText(this.thune)
                    this.PotionItem.setVisible(false)
                    this.AchatPotion=true;
                }
            }

            VerifAchatPizza(){
                if(this.keys.f.isDown && this.thune>=100 && this.AchatPizza==false ){
                    this.thune-=100
                    this.ArgentTxT.setText(this.thune)
                    this.PizzaItem.setVisible(false)
                    this.AchatPizza=true;
                    this.HpJoueur+=2
                }
            }

            VerifAchatDonut(){
                if(this.keys.f.isDown && this.thune>=50 && this.AchatDonut==false){
                    this.thune-=50
                    this.ArgentTxT.setText(this.thune)
                    this.DonutItem.setVisible(false)
                    this.AchatDonut=true;
                    this.HpJoueur+=1
                }
            }

            SellItems(){
                if(this.keys.f.isDown){
                    const ItemGlobal=this.LootBatV+this.LootRockV;
                    this.thune+=ItemGlobal*4;
                    this.LootBatV=0;
                    this.LootRockV=0;
                    this.ArgentTxT.setText(this.thune);
                    this.LootBatTxT.setText(this.LootBatV);
                    this.LootRockTxT.setText(this.LootRockV);
                }
            }

            SpikeDegat(player,Pique){
                if(this.invincible === false && Pique.anims.currentFrame.index>=15){
                        this.invincible = true;
                        this.HpJoueur --;
                        player.setTint(0xff0000);
                        this.cameras.main.shake(100, 0.01);
                    }
            }

            GetClé1(player,drop){
                drop.destroy()
                if (this.createclé==false){
                    this.CléNul = this.add.sprite(924,237, 'clénul');
                    this.CléNul.setScrollFactor(0);
                    this.CléNul.setDepth(10);
                }
                this.createclé=true;
                this.Getclé = true;
            }

            LootChestD1(player,chest){
                if(this.keys.f.isDown){
                    this.ChestGD1.playAnimation("ChestOpen");
                    var Coin = this.CoinG.create(chest.x+10,chest.y+25, "DropMoney");
                    var Coin = this.CoinG.create(chest.x+30,chest.y-20, "DropMoney");
                    var Heal = this.HealG.create(chest.x+50,chest.y-20, "DonutSprite");
                    Heal.setScale(0.5);
                    this.CléNulDrop = this.physics.add.image(chest.x-20,chest.y-10, 'clénul');
                    this.physics.add.overlap(this.player, this.CléNulDrop, this.GetClé1, null, this);
                } 
            }
            
            LootChestG1(player,chest){
                if(this.keys.f.isDown){
                    this.ChestGG1.playAnimation("ChestOpen");
                    var Coin = this.CoinG.create(chest.x+10,chest.y+25, "DropMoney");
                    var Coin = this.CoinG.create(chest.x+30,chest.y-20, "DropMoney");
                    var Coin = this.CoinG.create(chest.x-20,chest.y-10, "DropMoney");
                } 
            }

            UseKey(){
                if(this.keys.f.isDown && this.Getclé == true){
                    this.utilisecléV=true;
                    this.CléNul.destroy();
                }
            }

            FireOn(balle,camps){
                if(this.feuV==true){
                    this.FireOnG.create(camps.x+15,camps.y, "FireSprite");
                    balle.disableBody(true,true);
                    this.FireOnG.playAnimation("FireSpriteA");
                }
            }
            
            Salle1SpawnVerif(){
                if(this.salle1visit==false){
                    this.spawnS1=true
                }else{

                }
            }

            Salle3SpawnVerif(){
                if(this.salle3visit==false){
                    this.spawnS3=true
                }else{

                }
            }

            Salle4SpawnVerif(){
                if(this.salle4visit==false){
                    this.spawnS4=true
                }else{

                }
            }

            Salle5SpawnVerif(){
                if(this.salle5visit==false){
                    this.spawnS5=true
                }else{

                }
            }


            ActivPlaque1(){
                this.Plaque1A=true
                this.ImagePlaque1="PlaquePressionon"
                this.Plaque1.destroy()
                this.Plaque1 = this.physics.add.image(882,1035,"PlaquePressionon")
                this.Plaque1.setDepth(-1)
            }

            ActivPlaque2(){
                this.Plaque2A=true
                this.Plaque2.destroy()
                this.Plaque2 = this.physics.add.image(625,1200,"PlaquePressionon")
                this.Plaque2.setDepth(-1)
            }

            AttackM1(){               
                        this.PierreM1.anims.play('MonstreRockAttack', true)
                        if (this.PierreM1.x > this.player.x)
                        this.PierreM1.setVelocityX(-60)
                        if (this.PierreM1.x < this.player.x)
                        this.PierreM1.setVelocityX(60)
                        if (this.PierreM1.y < this.player.y)
                        this.PierreM1.setVelocityY(60)
                        if (this.PierreM1.y > this.player.y)
                        this.PierreM1.setVelocityY(-60) 
            }
            
            AttackM2(){               
                        this.PierreM2.anims.play('MonstreRockAttack', true)
                        if (this.PierreM2.x > this.player.x)
                        this.PierreM2.setVelocityX(-60)
                        if (this.PierreM2.x < this.player.x)
                        this.PierreM2.setVelocityX(60)
                        if (this.PierreM2.y < this.player.y)
                        this.PierreM2.setVelocityY(60)
                        if (this.PierreM2.y > this.player.y)
                        this.PierreM2.setVelocityY(-60) 
            }

            AttackM3(){               
                        this.PierreM3.anims.play('MonstreRockAttack', true)
                        if (this.PierreM3.x > this.player.x)
                        this.PierreM3.setVelocityX(-60)
                        if (this.PierreM3.x < this.player.x)
                        this.PierreM3.setVelocityX(60)
                        if (this.PierreM3.y < this.player.y)
                        this.PierreM3.setVelocityY(60)
                        if (this.PierreM3.y > this.player.y)
                        this.PierreM3.setVelocityY(-60) 
            }

            AttackM4(){               
                        this.PierreM4.anims.play('MonstreRockAttack', true)
                        if (this.PierreM4.x > this.player.x)
                        this.PierreM4.setVelocityX(-60)
                        if (this.PierreM4.x < this.player.x)
                        this.PierreM4.setVelocityX(60)
                        if (this.PierreM4.y < this.player.y)
                        this.PierreM4.setVelocityY(60)
                        if (this.PierreM4.y > this.player.y)
                        this.PierreM4.setVelocityY(-60) 
            }

            AttackM5(){               
                        this.PierreM5.anims.play('MonstreRockAttack', true)
                        if (this.PierreM5.x > this.player.x)
                        this.PierreM5.setVelocityX(-60)
                        if (this.PierreM5.x < this.player.x)
                        this.PierreM5.setVelocityX(60)
                        if (this.PierreM5.y < this.player.y)
                        this.PierreM5.setVelocityY(60)
                        if (this.PierreM5.y > this.player.y)
                        this.PierreM5.setVelocityY(-60) 
            }

            AttackM6(){               
                        this.PierreM6.anims.play('MonstreRockAttack', true)
                        if (this.PierreM6.x > this.player.x)
                        this.PierreM6.setVelocityX(-60)
                        if (this.PierreM6.x < this.player.x)
                        this.PierreM6.setVelocityX(60)
                        if (this.PierreM6.y < this.player.y)
                        this.PierreM6.setVelocityY(60)
                        if (this.PierreM6.y > this.player.y)
                        this.PierreM6.setVelocityY(-60) 
            }

            AttackM7(){               
                        this.PierreM7.anims.play('MonstreRockAttack', true)
                        if (this.PierreM7.x > this.player.x)
                        this.PierreM7.setVelocityX(-60)
                        if (this.PierreM7.x < this.player.x)
                        this.PierreM7.setVelocityX(60)
                        if (this.PierreM7.y < this.player.y)
                        this.PierreM7.setVelocityY(60)
                        if (this.PierreM7.y > this.player.y)
                        this.PierreM7.setVelocityY(-60) 
            }

            
            AttackM8(){               
                        this.PierreM8.anims.play('MonstreRockAttack', true)
                        if (this.PierreM8.x > this.player.x)
                        this.PierreM8.setVelocityX(-60)
                        if (this.PierreM8.x < this.player.x)
                        this.PierreM8.setVelocityX(60)
                        if (this.PierreM8.y < this.player.y)
                        this.PierreM8.setVelocityY(60)
                        if (this.PierreM8.y > this.player.y)
                        this.PierreM8.setVelocityY(-60) 
            }

            AttackM9(){               
                        this.PierreM9.anims.play('MonstreRockAttack', true)
                        if (this.PierreM9.x > this.player.x)
                        this.PierreM9.setVelocityX(-60)
                        if (this.PierreM9.x < this.player.x)
                        this.PierreM9.setVelocityX(60)
                        if (this.PierreM9.y < this.player.y)
                        this.PierreM9.setVelocityY(60)
                        if (this.PierreM9.y > this.player.y)
                        this.PierreM9.setVelocityY(-60) 
            }

            TakeMoney(player,drop){
                drop.destroy();
                this.thune+=3;
                this.ArgentTxT.setText(this.thune);
            }

            TakeHeal(player,drop){
                drop.destroy();
                this.HpJoueur+=1
            }

            trackennemie(monstre){
                if (monstre.x > this.player.x)
                    monstre.setVelocityX(-60)
                if (monstre.x < this.player.x)
                    monstre.setVelocityX(60)
                if (monstre.y < this.player.y)
                    monstre.setVelocityY(60)
                    if (monstre.y > this.player.y)
                    monstre.setVelocityY(-60)
            }
            update(){ 
                this.Marchand.anims.play("MarchandA",true);
                this.DonutItem.anims.play("DonutA",true);
                this.PizzaItem.anims.play("PizzaA",true);
                this.PotionItem.anims.play("PotionA",true);
                if(this.HpJoueur>3){
                    this.HpJoueur=3
                }

                if(((this.player.x >= 251 && this.player.x <= 370) && (this.player.y >=280 && this.player.y <= 324)) && this.AchatPotion==false){
                    this.TextePotion.setVisible(true);
                }else{
                    this.TextePotion.setVisible(false);
                }

                if(((this.player.x >= 242 && this.player.x <= 349) && (this.player.y >=232 && this.player.y <= 269)) && this.AchatPizza==false){
                    this.TextePizza.setVisible(true);
                }else{
                    this.TextePizza.setVisible(false);
                }

                if(((this.player.x >= 235 && this.player.x <= 328) && (this.player.y >=338 && this.player.y <= 363))  && this.AchatDonut==false){
                    this.TexteDonut.setVisible(true);
                }else{
                    this.TexteDonut.setVisible(false);
                }


                this.OnPotion=false

                this.FireOnG.children.each(function(fire) {
                    fire.anims.play("FireSpriteA",true);
                }, this);

                if(this.Plaque1A==true && this.Plaque2A==true){
                    this.BlockZone1Gauche.setVisible(false);
                    this.physics.world.removeCollider(this.collidePG);
                }

                if(this.utilisecléV==true){
                    this.BlockZone1Droite.setVisible(false);
                    this.physics.world.removeCollider(this.collidePD);
                }                 

                this.label.setText('(' + Math.trunc(this.player.x) + ', ' + Math.trunc(this.player.y) + ')');

                if ((this.player.x >= 1647 && this.player.x <= 1687) && (this.player.y >=437 && this.player.y <= 461)){
                    this.scene.start("sceneExemple2",{
                        HpJoueur : this.HpJoueur
                    });
                }

                if (this.HpJoueur>=3){
                    this.Pvbarre.anims.play("HP1", true);
                }

                if (this.HpJoueur==2){
                    this.Pvbarre.anims.play("HP2", true);
                }

                if (this.HpJoueur==1){
                    this.Pvbarre.anims.play("HP3", true);
                }

                if(this.AchatPotion==true){
                    this.PotionHud = this.add.sprite(825,205, 'PotionHUD');
                    this.PotionHud.setScrollFactor(0);
                    if(this.potionCheck==false){
                        this.PotionStatus=1;
                    }
                }

                if (this.PotionStatusHUD==3){
                    this.PotionHud.anims.play("PotionHUDState1", true);
                }

                if (this.PotionStatusHUD==2){
                    this.PotionHud.anims.play("PotionHUDState2", true);
                }

                if (this.PotionStatusHUD<=1){
                    this.PotionHud.anims.play("PotionHUDState3", true);
                }

                if (this.HpJoueur<=0){
                    this.Death()
                }    
                
                if (this.spawnS1==true){
                    this.BatM1 = this.BatM.create(2443,997, "MonstreBA");           ///salle 1
                    this.BatM1.setBounce(1);
                    this.BatM2 = this.BatM.create(2351,1188, "MonstreBA");
                    this.BatM2.setBounce(1);
                    this.spawnS1=false
                    this.salle1visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }

                if (this.spawnS3==true){
                    this.BatM3 = this.BatM.create(2920,693, "MonstreBA");           ///salle 1
                    this.BatM3.setBounce(1);
                    this.BatM4 = this.BatM.create(2773,550, "MonstreBA");
                    this.BatM4.setBounce(1);
                    this.BatM5 = this.BatM.create(2528,798, "MonstreBA");
                    this.BatM5.setBounce(1);
                    this.spawnS3=false
                    this.salle3visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }

                if (this.spawnS4==true){
                    this.BatM6 = this.BatM.create(1119,578, "MonstreBA");           ///salle 1
                    this.BatM6.setBounce(1);
                    this.BatM7 = this.BatM.create(623,643, "MonstreBA");
                    this.BatM7.setBounce(1);
                    this.spawnS4=false
                    this.salle4visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }

                if (this.spawnS5==true){
                    this.BatM8 = this.BatM.create(1907,381, "MonstreBA");           ///salle 1
                    this.BatM8.setBounce(1);
                    this.BatM9 = this.BatM.create(1907,185, "MonstreBA");
                    this.BatM9.setBounce(1);
                    this.BatM10 = this.BatM.create(1418,249, "MonstreBA");
                    this.BatM10.setBounce(1);
                    this.BatM11 = this.BatM.create(1657,376, "MonstreBA");
                    this.BatM11.setBounce(1);
                    this.spawnS5=false
                    this.salle5visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }


                this.trackennemie(this.BatM1);
                this.trackennemie(this.BatM2);
                this.trackennemie(this.BatM3);
                this.trackennemie(this.BatM4);
                this.trackennemie(this.BatM5);
                this.trackennemie(this.BatM6);
                this.trackennemie(this.BatM7);
                this.trackennemie(this.BatM8);
                this.trackennemie(this.BatM9);
                this.trackennemie(this.BatM10);
                this.trackennemie(this.BatM11);

                this.AgroZoneM1.x=this.PierreM1.x;
                this.AgroZoneM1.y=this.PierreM1.y;
                this.AgroZoneM2.x=this.PierreM2.x;
                this.AgroZoneM2.y=this.PierreM2.y;
                this.AgroZoneM3.x=this.PierreM3.x;
                this.AgroZoneM3.y=this.PierreM3.y;
                this.AgroZoneM4.x=this.PierreM4.x;
                this.AgroZoneM4.y=this.PierreM4.y;
                this.AgroZoneM5.x=this.PierreM5.x;
                this.AgroZoneM5.y=this.PierreM5.y;
                this.AgroZoneM6.x=this.PierreM6.x;
                this.AgroZoneM6.y=this.PierreM6.y;
                this.AgroZoneM7.x=this.PierreM7.x;
                this.AgroZoneM7.y=this.PierreM7.y;
                this.AgroZoneM8.x=this.PierreM8.x;
                this.AgroZoneM8.y=this.PierreM8.y;
                this.AgroZoneM9.x=this.PierreM9.x;
                this.AgroZoneM9.y=this.PierreM9.y;

                //console.log(this.player.x,this.player.y)
                ///console.log(this.PierreM1.x,this.PierreM1.y,this.player.x,this.player.y)
                this.physics.add.overlap(this.player, this.AgroZoneM1, this.AttackM1, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM2, this.AttackM2, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM3, this.AttackM3, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM4, this.AttackM4, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM5, this.AttackM5, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM6, this.AttackM6, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM7, this.AttackM7, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM8, this.AttackM8, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM9, this.AttackM9, null, this);

                if(this.invincible == true){
                    this.compteur-- ;
                if(this.compteur == 0){
                    this.compteur = 60;
                    this.player.setTint(0xffffff);                   //invincibilité avec compteur 
                    this.invincible = false ;
                    }
                }

                if(this.fallV==true && this.PotionStatus==4){
                    this.tailleP-=0.01
                    this.player.setScale(this.tailleP);
                    this.player.angle += 3;
                    this.player.alpha -= 0.01;
                    this.invincible=true;
                    if (this.tailleP<=0){
                        this.invincible=false;
                        this.MonstreAttaque()
                        if (this.player.direction=='gauche'){
                            this.player.x+=30
                        }
                        if (this.player.direction=='droite'){
                            this.player.x-=40
                        }
                         if (this.player.direction=='haut'){
                            this.player.y+=30
                        }
                         if (this.player.direction=='bas'){
                            this.player.y-=40
                        }
                        this.tailleP=1;
                        this.player.setScale(this.tailleP);
                        this.player.alpha=255;
                        this.fallV=false;
                        this.speedconst=140;
                        this.player.angle = 1;
                    }
                }
                
                if(this.fallV==true && this.PotionStatus>=1 && this.PotionStatus!=4){
                    this.potionCheck=true;
                    this.tailleP-=0.01
                        this.player.setScale(this.tailleP);
                        this.player.angle += 3;
                        this.player.alpha -= 0.01;
                    if (this.tailleP<=0){
                        if (this.player.direction=='gauche'){
                            this.player.x+=30
                        }
                        if (this.player.direction=='droite'){
                            this.player.x-=40
                        }
                        if (this.player.direction=='haut'){
                            this.player.y+=30
                        }
                        if (this.player.direction=='bas'){
                            this.player.y-=40
                        }
                        this.tailleP=1;
                        this.player.setScale(this.tailleP);
                        this.player.alpha=255;
                        this.fallV=false;
                        this.speedconst=140;
                        this.player.angle = 1;
                        this.PotionStatus+=1
                        this.PotionStatusHUD-=1
                    }
                }

                if(this.PotionStatus==3){
                    this.PotionStatus=4
                }

                if(this.keys.r.isDown){
                    this.haut="upF";
                    this.bas="downF";
                    this.droite="rightF";
                    this.gauche="leftF";
                    this.immobileB="staticFB";
                    this.immobileH="staticFH";
                    this.immobileG="staticFG";
                    this.immobileD="staticFD";
                    this.feuV=true;
                }
                if(this.feuV==true){
                    if (this.player.direction == 'gauche') { 
                        this.BulletA="BulletShootFG";
                    } 
                    else if (this.player.direction == 'droite'){ 
                        this.BulletA="BulletShootFD";
                    }
                    else if (this.player.direction == 'haut'){ 
                        this.BulletA="BulletShootFH";
                    }
                    else if (this.player.direction == 'bas'){ 
                        this.BulletA="BulletShootFB";
                    }
                }

                if(this.keys.e.isDown){
                    this.haut="upB";
                    this.bas="downB";
                    this.droite="rightB";
                    this.gauche="leftB";
                    this.immobileB="staticBB";
                    this.immobileH="staticBH";
                    this.immobileG="staticBG";
                    this.immobileD="staticBD";
                    this.BulletA="BulletShoot";
                    this.feuV=false;
                }

                //console.log(this.player.x,this.player.y)
                const {keys} = this
                this.speed = this.speedconst

                this.player.body.setVelocity(0)
                if(Phaser.Input.Keyboard.JustDown(this.keys.a)){
                    if (this.fallV==true){                  
                    }else{
                    this.tirer(this.player)
                    }
                }

                if ((this.cursors.left.isDown || this.keys.q.isDown) && this.fallV==false){
                    this.player.body.setVelocityX(-this.speed)
                    this.player.direction="gauche"

                }else if ((this.cursors.right.isDown || this.keys.d.isDown) && this.fallV==false){
                    this.player.body.setVelocityX(this.speed)
                    this.player.direction="droite"
                }
                else if ((this.cursors.up.isDown || this.keys.z.isDown) && this.fallV==false){
                    this.player.body.setVelocityY(-this.speed)
                    this.player.direction="haut"
                }else if ((this.cursors.down.isDown || this.keys.s.isDown) && this.fallV==false){                this.player.body.setVelocityY(this.speed)
                    this.player.direction="bas"
                }            

                this.player.body.velocity.normalize().scale(this.speed)

                if (this.cursors.left.isDown || this.keys.q.isDown){
                    this.player.anims.play(this.gauche, true)

                }else if (this.cursors.right.isDown || this.keys.d.isDown){
                    this.player.anims.play(this.droite, true)
                }else if (this.cursors.up.isDown || this.keys.z.isDown){
                    this.player.anims.play(this.haut, true)
                }else if (this.cursors.down.isDown || this.keys.s.isDown){
                    this.player.anims.play(this.bas, true)
                } 
                else if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="gauche"){
                    this.player.anims.play(this.immobileG, true)
                }
                else if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="bas"){
                    this.player.anims.play(this.immobileB, true)
                }
                else if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="droite"){
                    this.player.anims.play(this.immobileD, true)
                }
                if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="haut"){
                    this.player.anims.play(this.immobileH, true)
                }

                this.input.gamepad.once('connected', function (pad) {
                            this.controller = this.pad1;                     //verif si la manette est branchée
                            this.isConnected = true; 
                        });

                if(this.isConnected){
                    this.player.setVelocityX(160* this.controller.leftStick.x);
                    this.player.setVelocityY(160* this.controller.leftStick.y);           // permet d'avoir un déplacement en 360
                        if (this.controller.leftStick.y < 0){
                            if(this.controller.A && AttaqueStatus==false) {      //deplacement manette
                            this.player.setVelocityY(-300-ResistenceN);
                            this.player.anims.play(haut, true);
                            }else{
                            this.player.setVelocityY(-100);
                            this.player.anims.play(haut, true);
                            }
                        } 
                        
                        else if (this.controller.leftStick.y > 0) { 
                            if(controller.A  && AttaqueStatus==false) {
                            this.player.setVelocityY(300-ResistenceP);
                            this.player.anims.play(bas, true);
                            }else{
                            this.player.setVelocityY(100);
                            this.player.anims.play(bas, true);
                            }
                        }
                
                        else if(this.controller.leftStick.x < 0){
                            if(this.controller.A  && AttaqueStatus==false) {
                                this.player.setVelocityX(-300-ResistenceN);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(gauche, true);
                                }else{
                                this.player.setVelocityX(-100);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(gauche, true);}
                        }
                        else if(this.controller.leftStick.x > 0){
                            if(this.controller.A  && AttaqueStatus==false) {
                                this.player.setVelocityX(300-ResistenceP);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(droite, true);
                            }else{
                                this.player.setVelocityX(100);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(droite, true);
                            }
                        }
                        else{
                            this.player.setVelocityX(0);
                            this.player.anims.play(immobile, true); 
                        }
                }                    
                
                
            } 
        };
         ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                           ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        class sceneExemple2 extends Phaser.Scene{
            constructor(){
            super("sceneExemple2");
            }
            init(data){
                this.HpJoueur=data.HpJoueur
            }
            preload(){
                //load de toute les images / sprites sheet 

                this.load.image("Phaser_Trou", "assets/SetHole.png");
                this.load.image("Phaser_Salle", "assets/Salle1.png");
                this.load.image("Phaser_Autres", "assets/SetAutre.png");
                this.load.image("MonstreR","assets/mobmc.png");
                this.load.image("AgroZ","assets/ZoneAgro.png");
                this.load.image("BourseHUD","assets/bourse.png");
                this.load.image("PiqueSolo","assets/PiqueSeul.png");  
                this.load.image("TriggerZone","assets/Zonetrigger.png"); 
                this.load.image("PlaquePressionoff","assets/PressurePlat1.png");
                this.load.image("PlaquePressionon","assets/PressurePlat2.png");
                this.load.image("BackPackHUD","assets/backpack.png");   
                this.load.image("BatLoot","assets/lootB.png");   
                this.load.image("RockLoot","assets/lootR.png");
                this.load.image("clénul","assets/clé1.png");
                this.load.image("clédar","assets/clé2.png");
                this.load.image("tapis","assets/Tapis.png");
                this.load.image("CampFireNull","assets/fireplaceNull.png");   
                this.load.image("DropMoney","assets/MoneyDrop.png");
                this.load.image("DonutTexte","assets/DonutTxT.png");
                this.load.image("PizzaTexte","assets/PizzaTxT.png");
                this.load.image("PotionTexte","assets/PotionTxT.png");                                               
                this.load.tilemapTiledJSON("carte2", "DonjonMap2.json");  
                
                this.load.spritesheet('PersoSprite','assets/spritesheetP.png',
                { frameWidth: 38, frameHeight: 42 });
                this.load.spritesheet('PersoSpriteF','assets/spritesheetPF.png',
                { frameWidth: 38, frameHeight: 42 });
                this.load.spritesheet('AnimBoule1','assets/AnimBullet1.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2D','assets/AnimBullet2D.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2H','assets/bulletspritesheetFH.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2G','assets/bulletspritesheetFG.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('AnimBoule2B','assets/bulletspritesheetFB.png',
                { frameWidth: 16, frameHeight: 16 });
                this.load.spritesheet('MonstreRA','assets/spritesheetMC.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('MonstreBA','assets/spritesheetMB.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('PVbar','assets/spritesheetPV.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('SpikeA','assets/spritesheetPique.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('FireSprite','assets/firespritesheet.png',
                { frameWidth: 32, frameHeight: 64 });
                this.load.spritesheet('ChestSprite','assets/ChestSpriteSheet.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('MarchandSprite','assets/ShopSpriteSheet.png',
                { frameWidth: 96, frameHeight: 128 });
                this.load.spritesheet('DonutSprite','assets/SpriteSheetDonut.png',
                { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('PizzaSprite','assets/SpriteSheetPizza.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('PotionSprite','assets/PotionSpriteSheet.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('PotionHUD','assets/SpriteSheetPotionHUD.png',
                { frameWidth: 64, frameHeight: 64 });

                this.load.bitmapFont('carrier_command', 'assets/carrier_command.png', 'assets/carrier_command.xml');

            }  

            
            
        

            create (){
                this.isConnected = false;
                this.directionX=0
                this.directionY=750 * 1
                this.directionTY=1
                this.directionTX=0
                this.haut="upB";
                this.bas="downB";
                this.droite="rightB";
                this.gauche="leftB";
                this.immobileB="staticBB";
                this.immobileH="staticBH";
                this.immobileG="staticBG";
                this.immobileD="staticBD";
                this.invincible=false;
                this.compteur = 60;
                this.fallV=false;
                this.tailleP=1;
                this.speedconst = 1000;
                this.thune=0;
                this.LootBatV=0;
                this.LootRockV=0;
                this.spawnS1=false;
                this.salle1visit=false;;
                this.spawnS3=false;
                this.salle3visit=false;
                this.spawnS4=false;
                this.salle4visit=false;
                this.spawnS5=false;
                this.salle5visit=false
                this.Plaque1A=false;
                this.Plaque2A=false;
                this.ImagePlaque1="PlaquePressionoff";
                this.ImagePlaque2="PlaquePressionoff";
                this.BulletA="BulletShoot";
                this.feuV=false;
                this.utilisecléV=false;
                this.Getclé = false;
                this.createclé=false;
                this.inZone = false;
                this.OnPotion = false;
                this.createAfficheP=true;
                this.AchatPotion=false;
                this.AchatPizza=false;
                this.AchatDonut=false;
                this.PotionStatus=4;
                this.potionCheck=false;
                this.PotionStatusHUD=3;

                const carteDuNiveau = this.make.tilemap({ key: "carte2"});
                
                // importer TileSet 
                        
                const tileset1 = carteDuNiveau.addTilesetImage(
                        "Salle1T",
                        "Phaser_Salle",
                        32,
                        32
                        );  

                const tileset2 = carteDuNiveau.addTilesetImage(
                        "SetHole",
                        "Phaser_Trou",
                        32,
                        32
                        ); 
                        
                const tileset3 = carteDuNiveau.addTilesetImage(
                        "SetAutre",
                        "Phaser_Autres",
                        32,
                        32
                        ); 

                // importer les calques 


                const Calque5 = carteDuNiveau.createLayer(
                        "SalleB",
                        tileset1,
                    ); 

                this.Calque = carteDuNiveau.createLayer(
                        "Blocs",
                        tileset2,
                    );

                 const Calque21 = carteDuNiveau.createLayer(
                        "Decors-1",
                        tileset2,
                    ); 

                const Calque2 = carteDuNiveau.createLayer(
                        "Decors",
                        tileset2,
                    ); 

                const CalqueDecors2 = carteDuNiveau.createLayer(
                        "Decors2",
                        tileset2,
                    ); 

                const CalqueA = carteDuNiveau.createLayer(
                        "Decors Autres",
                        tileset3,
                    ); 

                const Calque3 = carteDuNiveau.createLayer(
                        "Solid",
                        tileset2,
                    );

                const CalqueSJ = carteDuNiveau.createLayer(
                        "SolidJ",
                        tileset2,
                    ); 

                const CalqueSM = carteDuNiveau.createLayer(
                        "SolidM",
                        tileset2,
                    );    

                const CalqueMort = carteDuNiveau.createLayer(
                        "Mort",
                        tileset2,
                    );

                this.CalquePorte2 = carteDuNiveau.createLayer(
                        "PortesP",
                        tileset1,
                    );

                const CalqueStairs = carteDuNiveau.createLayer(
                        "stair",
                        tileset1,
                    );

                this.BlockZone1Gauche = carteDuNiveau.createLayer(
                        "PorteBlockZ1G",
                        tileset1,
                    );
                    
                this.BlockZone1Droite = carteDuNiveau.createLayer(
                        "PorteBlockZ1D",
                        tileset1,
                    );

                this.BlockZone1Gauche.setCollisionByProperty({ estSolide: true }); 
                this.BlockZone1Gauche.setDepth(3)
                
                this.BlockZone1Droite.setCollisionByProperty({ estSolide: true }); 
                this.BlockZone1Droite.setDepth(3)

                this.CléUtiliser = this.physics.add.image(2239,845,"AgroZ")
                this.CléUtiliser.setSize(50, 50)

                this.DropsRock=this.physics.add.group();
                this.DropsBat=this.physics.add.group();
                this.FireOnG=this.physics.add.group();

                this.SpikeG=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.anims.create({
                    key: 'SpikeAnim',           
                    frames: this.anims.generateFrameNumbers('SpikeA', {start:0,end:16}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.Calque.setDepth(-2)

                carteDuNiveau.getObjectLayer('Spike').objects.forEach((spike) => {
                    // Add new spikes to our sprite group
                    const spikeSprite = this.SpikeG.create(spike.x, spike.y -= 32,'PiqueSolo').setOrigin(0);
                });

                this.SpikeG.playAnimation("SpikeAnim");
                
                this.CampG=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                carteDuNiveau.getObjectLayer('FireCamp').objects.forEach((camps) => {
                    // Add new spikes to our sprite group
                    const CampSprite = this.CampG.create(camps.x, camps.y -= 32,'CampFireNull').setOrigin(0);
                });

                this.Plaque1 = this.physics.add.image(1395,1463,"PlaquePressionoff")
                this.Plaque2 = this.physics.add.image(1170,1675,"PlaquePressionoff")
                this.PotionItem = this.physics.add.sprite(304,300, 'PotionSprite');
                this.PotionItem.body.setSize(128,64,true)
                this.PotionItem.setOffset(8, 15)

                this.player = this.physics.add.sprite(1190,120, 'PersoSprite');
                this.player.body.setSize(24,12,true)
                this.player.setOffset(8, 28)
                this.player.alpha = 1;  
                Calque3.setCollisionByProperty({ estSolide: true });         //background et plateformes
                CalqueSJ.setCollisionByProperty({ estSolide: true }); 
                CalqueSM.setCollisionByProperty({ estSolide: true }); 
                CalqueMort.setCollisionByProperty({ Tue: true });         //background et plateformes
                this.physics.add.collider(this.player, Calque3);
                this.physics.add.collider(this.player, CalqueSJ);
                this.collidePG=this.physics.add.collider(this.player, this.BlockZone1Gauche);
                this.collidePD=this.physics.add.collider(this.player, this.BlockZone1Droite);
                this.physics.add.collider(this.player, CalqueMort, this.Fall,null,this);
                this.ArgentTxT= this.add.bitmapText(445, 195, 'carrier_command',this.thune,9);
                this.ArgentTxT.setScrollFactor(0);
                this.LootBatTxT= this.add.bitmapText(906, 210, 'carrier_command',this.LootBatV,9);
                this.LootBatTxT.setScrollFactor(0);
                this.LootRockTxT= this.add.bitmapText(890, 250, 'carrier_command',this.LootRockV,9);
                this.LootRockTxT.setScrollFactor(0);
                this.label = this.add.text(460, 195, '(x,y)', { fontFamily: '"Monospace"'});
                this.label.setScrollFactor(0)

                this.groupeBalles = this.physics.add.group();  
                this.physics.add.collider(this.groupeBalles, Calque3, this.destroy,null,this);

                this.BlocsDS1=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.BlocsDS3=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.BlocsGS2=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                this.BlocsHS4=this.physics.add.group({
                    allowGravity: false,
                    immovable:true
                });

                carteDuNiveau.getObjectLayer('Salle1D').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd1 = this.BlocsDS1.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                carteDuNiveau.getObjectLayer('Salle3D').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd2 = this.BlocsDS3.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                carteDuNiveau.getObjectLayer('Salle2G').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd3 = this.BlocsGS2.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                carteDuNiveau.getObjectLayer('Salle4H').objects.forEach((blocsV) => {
                    // Add new spikes to our sprite group
                    const Blocd4 = this.BlocsHS4.create(blocsV.x, blocsV.y -= 32,"TriggerZone").setOrigin(0);
                });

                this.ChestGD1=this.physics.add.group();
                this.ChestD1 = this.ChestGD1.create(2123,668, "ChestSprite");
                this.ChestD1.body.setSize(150,150,true);

                this.ChestGG1=this.physics.add.group();
                this.ChestG1 = this.ChestGG1.create(267,1082, "ChestSprite");
                this.ChestG1.body.setSize(150,150,true);
                
                this.CoinG=this.physics.add.group();
                this.HealG=this.physics.add.group();

                this.PierresM=this.physics.add.group();
                this.physics.add.collider(this.PierresM, Calque3);
                this.physics.add.collider(this.PierresM, CalqueSJ);
                this.physics.add.collider(this.PierresM, CalqueSM);
                this.PierreM1 = this.PierresM.create(2766,1174, "MonstreR");
                this.PierreM1.setBounce(1);
                this.PierreM2 = this.PierresM.create(2880,1032, "MonstreR");
                this.PierreM2.setBounce(1);
                this.PierreM3 = this.PierresM.create(2523,546, "MonstreR");
                this.PierreM3.setBounce(1);
                this.PierreM4 = this.PierresM.create(2199,751, "MonstreR");
                this.PierreM4.setBounce(1);
                this.PierreM5 = this.PierresM.create(2164,586, "MonstreR");
                this.PierreM5.setBounce(1);
                this.PierreM6 = this.PierresM.create(819,676, "MonstreR");
                this.PierreM6.setBounce(1);
                this.PierreM7 = this.PierresM.create(861,1153, "MonstreR");
                this.PierreM7.setBounce(1);
                this.PierreM8 = this.PierresM.create(1108,256, "MonstreR");
                this.PierreM8.setBounce(1);
                this.PierreM9 = this.PierresM.create(1804,355, "MonstreR");
                this.PierreM9.setBounce(1);

                this.BatM=this.physics.add.group();
                this.physics.add.collider(this.BatM, Calque3);
                this.BatM1 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM2 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM3 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM4 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM5 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM6 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM7 = this.BatM.create(1000000000,1000000000, "MonstreBA");
                this.BatM8 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM9 = this.BatM.create(1000000000,1000000000, "MonstreBA");
                this.BatM10 = this.BatM.create(1000000000,1000000000, "MonstreBA");  
                this.BatM11 = this.BatM.create(1000000000,1000000000, "MonstreBA");       
                
                this.AgroZoneM1 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM1.setSize(224, 224)
                this.AgroZoneM2 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM2.setSize(224, 224)
                this.AgroZoneM3 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM3.setSize(224, 224)
                this.AgroZoneM4 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM4.setSize(224, 224)
                this.AgroZoneM5 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM5.setSize(224, 224)
                this.AgroZoneM6 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM6.setSize(224, 224)
                this.AgroZoneM7 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM7.setSize(224, 224)
                this.AgroZoneM8 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM8.setSize(224, 224)
                this.AgroZoneM9 = this.physics.add.image(0,0,"AgroZ")
                this.AgroZoneM9.setSize(224, 224)

                
                
                this.physics.add.overlap(this.groupeBalles, this.PierresM, this.AttaqueRock, null, this);
                this.physics.add.overlap(this.groupeBalles, this.BatM, this.AttaqueBat, null, this);
                this.physics.add.overlap(this.groupeBalles, this.CampG, this.FireOn, null, this);
                this.physics.add.overlap(this.player, this.BatM, this.MonstreAttaque, null, this);
                this.physics.add.overlap(this.player, this.PierresM, this.MonstreAttaque, null, this);
                this.physics.add.overlap(this.player, this.SpikeG, this.SpikeDegat, null, this);
                this.physics.add.overlap(this.player, this.Plaque1, this.ActivPlaque1, null, this);
                this.physics.add.overlap(this.player, this.Plaque2, this.ActivPlaque2, null, this);
                this.physics.add.overlap(this.player, this.BlocsDS1, this.Salle1SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.BlocsDS3, this.Salle3SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.BlocsGS2, this.Salle4SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.BlocsHS4, this.Salle5SpawnVerif, null, this);
                this.physics.add.overlap(this.player, this.DropsBat, this.TakeDropB, null, this);
                this.physics.add.overlap(this.player, this.DropsRock, this.TakeDropR, null, this);
                this.physics.add.overlap(this.player, this.CléUtiliser, this.UseKey, null, this);
                this.physics.add.overlap(this.player, this.CoinG, this.TakeMoney, null, this);
                this.physics.add.overlap(this.player, this.HealG, this.TakeHeal, null, this);
                this.physics.add.overlap(this.player, this.ChestD1, this.LootChestD1, null, this);
                this.physics.add.overlap(this.player, this.ChestG1, this.LootChestG1, null, this);

                this.CalquePorte = carteDuNiveau.createLayer(
                        "portes",
                        tileset1,
                    );
                this.CalquePorte.setDepth(2)

                this.player.setCollideWorldBounds(true);
                this.BourseImage = this.add.image(430,200,'BourseHUD');
                this.BourseImage.setScrollFactor(0);
                this.Pvbarre = this.add.sprite(360,205, 'PVbar');
                this.Pvbarre.setScrollFactor(0);
                this.BackPack = this.add.sprite(890,230, 'BackPackHUD');
                this.BackPack.setScrollFactor(0);
                this.LootBat = this.add.sprite(900,212, 'BatLoot');
                this.LootBat.setScrollFactor(0);
                this.LootRock = this.add.sprite(885,245, 'RockLoot');
                this.LootRock.setScrollFactor(0);
                this.PotionHud = this.add.sprite(1000,1000, 'PotionHUD');
                this.PotionHud.setScrollFactor(0);
                //this.CléDar = this.add.sprite(927,235, 'clédar');
                //this.CléDar.setScrollFactor(0);
                this.Pvbarre.setScale(0.8);
                this.LootBat.setDepth(10);
                this.LootRock.setDepth(10);
                //this.CléDar.setDepth(10);
                this.BackPack.setDepth(10);
                this.label.setDepth(10);
                this.ArgentTxT.setDepth(10);
                this.LootBatTxT.setDepth(11);
                this.LootRockTxT.setDepth(11);
                this.BourseImage.setDepth(10);
                this.Pvbarre.setDepth(10);
                this.PotionHud.setDepth(10);

                this.anims.create({
                    key: 'leftB',           
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:8,end:11}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:16,end:19}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBH',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:28,end:31}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBD',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:20,end:23}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticBG',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:24,end:27}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'rightB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:4,end:7}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'downB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:0,end:3}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'upB',
                    frames: this.anims.generateFrameNumbers('PersoSprite', {start:12,end:15}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'BulletShoot',           
                    frames: this.anims.generateFrameNumbers('AnimBoule1', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'leftF',           
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:8,end:11}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFB',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:16,end:19}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFH',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:28,end:31}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFD',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:20,end:23}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'staticFG',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:24,end:27}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'rightF',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:4,end:7}),
                    frameRate: 5,
                    repeat: -1,
                });
                
                this.anims.create({
                    key: 'downF',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:0,end:3}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'upF',
                    frames: this.anims.generateFrameNumbers('PersoSpriteF', {start:12,end:15}),
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFD',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2D', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFG',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2G', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFB',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2B', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'BulletShootFH',           
                    frames: this.anims.generateFrameNumbers('AnimBoule2H', {start:0,end:1}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'MonstreRockAttack',           
                    frames: this.anims.generateFrameNumbers('MonstreRA', {start:0,end:2}),          //creation des animation
                    frameRate: 5,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'MonstreBatAttack',           
                    frames: this.anims.generateFrameNumbers('MonstreBA', {start:0,end:1}),          //creation des animation
                    frameRate: 6,
                    repeat: -1,
                });

                this.anims.create({
                    key: 'HP1',           
                    frames: this.anims.generateFrameNumbers('PVbar', {start:0,end:0}),          //creation des animation
                    frameRate: 6,
                });

                this.anims.create({
                    key: 'HP2',           
                    frames: this.anims.generateFrameNumbers('PVbar', {start:1,end:1}),          //creation des animation
                    frameRate: 6,
                });

                this.anims.create({
                    key: 'HP3',           
                    frames: this.anims.generateFrameNumbers('PVbar', {start:2,end:2}),          //creation des animation
                    frameRate: 6,
                });
                
                this.anims.create({
                    key: 'FireSpriteA',           
                    frames: this.anims.generateFrameNumbers('FireSprite', {start:0,end:2}),          //creation des animation
                    frameRate: 5,
                });

                this.anims.create({
                    key: 'ChestClose',           
                    frames: this.anims.generateFrameNumbers('ChestSprite', {start:0,end:0}),          //creation des animation
                    frameRate: 5,
                });

                this.anims.create({
                    key: 'ChestOpen',           
                    frames: this.anims.generateFrameNumbers('ChestSprite', {start:1,end:1}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'MarchandA',           
                    frames: this.anims.generateFrameNumbers('MarchandSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'DonutA',           
                    frames: this.anims.generateFrameNumbers('DonutSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PizzaA',           
                    frames: this.anims.generateFrameNumbers('PizzaSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionA',           
                    frames: this.anims.generateFrameNumbers('PotionSprite', {start:0,end:5}),          //creation des animation
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionHUDState1',           
                    frames: this.anims.generateFrameNumbers('PotionHUD', {start:0,end:0}),
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionHUDState2',           
                    frames: this.anims.generateFrameNumbers('PotionHUD', {start:1,end:1}),
                    frameRate: 5,
                });
                this.anims.create({
                    key: 'PotionHUDState3',           
                    frames: this.anims.generateFrameNumbers('PotionHUD', {start:2,end:2}),
                    frameRate: 5,
                });

                this.physics.world.setBounds(0, 0, 2560, 3200);
                this.cameras.main.setBounds(0, 0, 2560,3200);
                this.cameras.main.zoom = 2;                  //Camera
                this.cameras.main.startFollow(this.player);  
                this.player.setCollideWorldBounds(true);
                // touches clavier
                this.cursors = this.input.keyboard.createCursorKeys();
                this.keys = this.input.keyboard.addKeys({
                    q:  Phaser.Input.Keyboard.KeyCodes.Q,
                    d:  Phaser.Input.Keyboard.KeyCodes.D,
                    s:  Phaser.Input.Keyboard.KeyCodes.S,
                    z:  Phaser.Input.Keyboard.KeyCodes.Z,
                    a:  Phaser.Input.Keyboard.KeyCodes.A,
                    e:  Phaser.Input.Keyboard.KeyCodes.E,               //importation de touche
                    r:  Phaser.Input.Keyboard.KeyCodes.R,  
                    f:  Phaser.Input.Keyboard.KeyCodes.F
                });
            }

            MonstreAttaque(player){
                if(this.invincible === false){
                        this.invincible = true;
                        this.HpJoueur --;
                        this.player.setTint(0xff0000);
                        this.cameras.main.shake(100, 0.01);
                    }
            }

            Death(){
                this.scene.restart();
                this.haut="upB";
                this.bas="downB";
                this.droite="rightB";
                this.gauche="leftB";
                this.immobile="staticB";
                this.invincible=false
            }

            Fall(){
                if (this.player.direction=='gauche')
                    this.player.x-=30
                if (this.player.direction=='droite')
                    this.player.x+=30
                if (this.player.direction=='haut')
                    this.player.y-=20
                if (this.player.direction=='bas')
                    this.player.y+=30
                this.fallV=true
                this.speedconst=0
            }

            destroy(balle){
                balle.disableBody(true,true)
            }

            tirer(player) {
                // choix de la direction de la balle en fonction de l'ancien ou du déplacement actuel du joueur
                if (player.direction == 'gauche') { 
                    this.directionX=750 * -0.5
                    this.directionY=0
                    this.directionTX=-2
                    this.directionTY=0
                } 
                else if (player.direction == 'droite'){ 
                    this.directionX=750 * 0.5
                    this.directionY=0
                    this.directionTX=2
                    this.directionTY=0
                }
                else if (player.direction == 'haut'){ 
                    this.directionX=0
                    this.directionY=750 * -0.5
                    this.directionTY=-2
                    this.directionTX=0
                }
                else if (player.direction == 'bas'){ 
                    this.directionX=0
                    this.directionY=750 * 0.5
                    this.directionTY=1
                    this.directionTX=0
                }
                
                var balle1 = this.groupeBalles.create(this.player.x + (15 * this.directionTX), this.player.y + (15 * this.directionTY));
                balle1.anims.play(this.BulletA,true);
                balle1.setCollideWorldBounds(true);
                balle1.body.onWorldBounds = true;  
                balle1.body.allowGravity =false;
                balle1.setVelocity(this.directionX, this.directionY); 
            }  
            
            AttaqueRock(balle,Monstreseul){
                Monstreseul.disableBody(true, true);
                balle.disableBody(true,true);
                this.thune+=Math.floor(Math.random() * 20)+1
                this.ArgentTxT.setText(this.thune)
                var DropRock = this.DropsRock.create(Monstreseul.x,Monstreseul.y, "RockLoot");
                DropRock.setScale(0.5)
                DropRock.body.setSize(100,100,true)
            }

            AttaqueBat(balle,Monstreseul){
                Monstreseul.disableBody(true, true);
                balle.disableBody(true,true);
                this.thune+=Math.floor(Math.random() * 20)+1
                this.ArgentTxT.setText(this.thune)
                var DropBat = this.DropsBat.create(Monstreseul.x,Monstreseul.y, "BatLoot");
                DropBat.setScale(0.5)
                DropBat.body.setSize(100,100,true)
            }

            TakeDropB(player,drop){
                drop.destroy()
                this.LootBatV+=1
                this.LootBatTxT.setText(this.LootBatV)
            }

            TakeDropR(player,drop){
                drop.destroy()
                this.LootRockV+=1
                this.LootRockTxT.setText(this.LootRockV)
            }

            SpikeDegat(player,Pique){
                if(this.invincible === false && Pique.anims.currentFrame.index>=15){
                        this.invincible = true;
                        this.HpJoueur --;
                        player.setTint(0xff0000);
                        this.cameras.main.shake(100, 0.01);
                    }
            }

            GetClé1(player,drop){
                drop.destroy()
                if (this.createclé==false){
                    this.CléNul = this.add.sprite(924,237, 'clénul');
                    this.CléNul.setScrollFactor(0);
                    this.CléNul.setDepth(10);
                }
                this.createclé=true;
                this.Getclé = true;
            }

            LootChestD1(player,chest){
                if(this.keys.f.isDown){
                    this.ChestGD1.playAnimation("ChestOpen");
                    var Coin = this.CoinG.create(chest.x+10,chest.y+25, "DropMoney");
                    var Coin = this.CoinG.create(chest.x+30,chest.y-20, "DropMoney");
                    var Heal = this.HealG.create(chest.x+50,chest.y-20, "DonutSprite");
                    Heal.setScale(0.5);
                    this.CléNulDrop = this.physics.add.image(chest.x-20,chest.y-10, 'clénul');
                    this.physics.add.overlap(this.player, this.CléNulDrop, this.GetClé1, null, this);
                } 
            }
            
            LootChestG1(player,chest){
                if(this.keys.f.isDown){
                    this.ChestGG1.playAnimation("ChestOpen");
                    var Coin = this.CoinG.create(chest.x+10,chest.y+25, "DropMoney");
                    var Coin = this.CoinG.create(chest.x+30,chest.y-20, "DropMoney");
                    var Coin = this.CoinG.create(chest.x-20,chest.y-10, "DropMoney");
                } 
            }

            UseKey(){
                if(this.keys.f.isDown && this.Getclé == true){
                    this.utilisecléV=true;
                    this.CléNul.destroy();
                }
            }

            FireOn(balle,camps){
                if(this.feuV==true){
                    this.FireOnG.create(camps.x+15,camps.y, "FireSprite");
                    balle.disableBody(true,true);
                    this.FireOnG.playAnimation("FireSpriteA");
                }
            }
            
            Salle1SpawnVerif(){
                if(this.salle1visit==false){
                    this.spawnS1=true
                }else{

                }
            }

            Salle3SpawnVerif(){
                if(this.salle3visit==false){
                    this.spawnS3=true
                }else{

                }
            }

            Salle4SpawnVerif(){
                if(this.salle4visit==false){
                    this.spawnS4=true
                }else{

                }
            }

            Salle5SpawnVerif(){
                if(this.salle5visit==false){
                    this.spawnS5=true
                }else{

                }
            }


            ActivPlaque1(){
                this.Plaque1A=true
                this.ImagePlaque1="PlaquePressionon"
                this.Plaque1.destroy()
                this.Plaque1 = this.physics.add.image(1395,1463,"PlaquePressionon")
                this.Plaque1.setDepth(-1)
            }

            ActivPlaque2(){
                this.Plaque2A=true
                this.Plaque2.destroy()
                this.Plaque2 = this.physics.add.image(1170,1675,"PlaquePressionon")
                this.Plaque2.setDepth(-1)
            }

            AttackM1(){               
                        this.PierreM1.anims.play('MonstreRockAttack', true)
                        if (this.PierreM1.x > this.player.x)
                        this.PierreM1.setVelocityX(-60)
                        if (this.PierreM1.x < this.player.x)
                        this.PierreM1.setVelocityX(60)
                        if (this.PierreM1.y < this.player.y)
                        this.PierreM1.setVelocityY(60)
                        if (this.PierreM1.y > this.player.y)
                        this.PierreM1.setVelocityY(-60) 
            }
            
            AttackM2(){               
                        this.PierreM2.anims.play('MonstreRockAttack', true)
                        if (this.PierreM2.x > this.player.x)
                        this.PierreM2.setVelocityX(-60)
                        if (this.PierreM2.x < this.player.x)
                        this.PierreM2.setVelocityX(60)
                        if (this.PierreM2.y < this.player.y)
                        this.PierreM2.setVelocityY(60)
                        if (this.PierreM2.y > this.player.y)
                        this.PierreM2.setVelocityY(-60) 
            }

            AttackM3(){               
                        this.PierreM3.anims.play('MonstreRockAttack', true)
                        if (this.PierreM3.x > this.player.x)
                        this.PierreM3.setVelocityX(-60)
                        if (this.PierreM3.x < this.player.x)
                        this.PierreM3.setVelocityX(60)
                        if (this.PierreM3.y < this.player.y)
                        this.PierreM3.setVelocityY(60)
                        if (this.PierreM3.y > this.player.y)
                        this.PierreM3.setVelocityY(-60) 
            }

            AttackM4(){               
                        this.PierreM4.anims.play('MonstreRockAttack', true)
                        if (this.PierreM4.x > this.player.x)
                        this.PierreM4.setVelocityX(-60)
                        if (this.PierreM4.x < this.player.x)
                        this.PierreM4.setVelocityX(60)
                        if (this.PierreM4.y < this.player.y)
                        this.PierreM4.setVelocityY(60)
                        if (this.PierreM4.y > this.player.y)
                        this.PierreM4.setVelocityY(-60) 
            }

            AttackM5(){               
                        this.PierreM5.anims.play('MonstreRockAttack', true)
                        if (this.PierreM5.x > this.player.x)
                        this.PierreM5.setVelocityX(-60)
                        if (this.PierreM5.x < this.player.x)
                        this.PierreM5.setVelocityX(60)
                        if (this.PierreM5.y < this.player.y)
                        this.PierreM5.setVelocityY(60)
                        if (this.PierreM5.y > this.player.y)
                        this.PierreM5.setVelocityY(-60) 
            }

            AttackM6(){               
                        this.PierreM6.anims.play('MonstreRockAttack', true)
                        if (this.PierreM6.x > this.player.x)
                        this.PierreM6.setVelocityX(-60)
                        if (this.PierreM6.x < this.player.x)
                        this.PierreM6.setVelocityX(60)
                        if (this.PierreM6.y < this.player.y)
                        this.PierreM6.setVelocityY(60)
                        if (this.PierreM6.y > this.player.y)
                        this.PierreM6.setVelocityY(-60) 
            }

            AttackM7(){               
                        this.PierreM7.anims.play('MonstreRockAttack', true)
                        if (this.PierreM7.x > this.player.x)
                        this.PierreM7.setVelocityX(-60)
                        if (this.PierreM7.x < this.player.x)
                        this.PierreM7.setVelocityX(60)
                        if (this.PierreM7.y < this.player.y)
                        this.PierreM7.setVelocityY(60)
                        if (this.PierreM7.y > this.player.y)
                        this.PierreM7.setVelocityY(-60) 
            }

            
            AttackM8(){               
                        this.PierreM8.anims.play('MonstreRockAttack', true)
                        if (this.PierreM8.x > this.player.x)
                        this.PierreM8.setVelocityX(-60)
                        if (this.PierreM8.x < this.player.x)
                        this.PierreM8.setVelocityX(60)
                        if (this.PierreM8.y < this.player.y)
                        this.PierreM8.setVelocityY(60)
                        if (this.PierreM8.y > this.player.y)
                        this.PierreM8.setVelocityY(-60) 
            }

            AttackM9(){               
                        this.PierreM9.anims.play('MonstreRockAttack', true)
                        if (this.PierreM9.x > this.player.x)
                        this.PierreM9.setVelocityX(-60)
                        if (this.PierreM9.x < this.player.x)
                        this.PierreM9.setVelocityX(60)
                        if (this.PierreM9.y < this.player.y)
                        this.PierreM9.setVelocityY(60)
                        if (this.PierreM9.y > this.player.y)
                        this.PierreM9.setVelocityY(-60) 
            }

            TakeMoney(player,drop){
                drop.destroy();
                this.thune+=3;
                this.ArgentTxT.setText(this.thune);
            }

            TakeHeal(player,drop){
                drop.destroy();
                this.HpJoueur+=1
            }

            trackennemie(monstre){
                if (monstre.x > this.player.x)
                    monstre.setVelocityX(-60)
                if (monstre.x < this.player.x)
                    monstre.setVelocityX(60)
                if (monstre.y < this.player.y)
                    monstre.setVelocityY(60)
                    if (monstre.y > this.player.y)
                    monstre.setVelocityY(-60)
            }
            update(){ 

                if(this.HpJoueur>3){
                    this.HpJoueur=3
                }

                this.FireOnG.children.each(function(fire) {
                    fire.anims.play("FireSpriteA",true);
                }, this);

                if(this.Plaque1A==true && this.Plaque2A==true){
                    this.BlockZone1Gauche.setVisible(false);
                    this.physics.world.removeCollider(this.collidePG);
                }

                if(this.utilisecléV==true){
                    this.BlockZone1Droite.setVisible(false);
                    this.physics.world.removeCollider(this.collidePD);
                }                 

                this.label.setText('(' + Math.trunc(this.player.x) + ', ' + Math.trunc(this.player.y) + ')');

                if ((this.player.x >= 1647 && this.player.x <= 1687) && (this.player.y >=437 && this.player.y <= 461)){
                    this.scene.start("sceneExemple2");
                }

                if (this.HpJoueur>=3){
                    this.Pvbarre.anims.play("HP1", true);
                }

                if (this.HpJoueur==2){
                    this.Pvbarre.anims.play("HP2", true);
                }

                if (this.HpJoueur==1){
                    this.Pvbarre.anims.play("HP3", true);
                }

                if (this.PotionStatusHUD==3){
                    this.PotionHud.anims.play("PotionHUDState1", true);
                }

                if (this.PotionStatusHUD==2){
                    this.PotionHud.anims.play("PotionHUDState2", true);
                }

                if (this.PotionStatusHUD<=1){
                    this.PotionHud.anims.play("PotionHUDState3", true);
                }

                if (this.HpJoueur<=0){
                    this.Death()
                }    
                
                if (this.spawnS1==true){
                    this.BatM1 = this.BatM.create(2443,997, "MonstreBA");           ///salle 1
                    this.BatM1.setBounce(1);
                    this.BatM2 = this.BatM.create(2351,1188, "MonstreBA");
                    this.BatM2.setBounce(1);
                    this.spawnS1=false
                    this.salle1visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }

                if (this.spawnS3==true){
                    this.BatM3 = this.BatM.create(2920,693, "MonstreBA");           ///salle 1
                    this.BatM3.setBounce(1);
                    this.BatM4 = this.BatM.create(2773,550, "MonstreBA");
                    this.BatM4.setBounce(1);
                    this.BatM5 = this.BatM.create(2528,798, "MonstreBA");
                    this.BatM5.setBounce(1);
                    this.spawnS3=false
                    this.salle3visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }

                if (this.spawnS4==true){
                    this.BatM6 = this.BatM.create(1119,578, "MonstreBA");           ///salle 1
                    this.BatM6.setBounce(1);
                    this.BatM7 = this.BatM.create(623,643, "MonstreBA");
                    this.BatM7.setBounce(1);
                    this.spawnS4=false
                    this.salle4visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }

                if (this.spawnS5==true){
                    this.BatM8 = this.BatM.create(1907,381, "MonstreBA");           ///salle 1
                    this.BatM8.setBounce(1);
                    this.BatM9 = this.BatM.create(1907,185, "MonstreBA");
                    this.BatM9.setBounce(1);
                    this.BatM10 = this.BatM.create(1418,249, "MonstreBA");
                    this.BatM10.setBounce(1);
                    this.BatM11 = this.BatM.create(1657,376, "MonstreBA");
                    this.BatM11.setBounce(1);
                    this.spawnS5=false
                    this.salle5visit=true
                    this.BatM.playAnimation("MonstreBatAttack");
                }


                this.trackennemie(this.BatM1);
                this.trackennemie(this.BatM2);
                this.trackennemie(this.BatM3);
                this.trackennemie(this.BatM4);
                this.trackennemie(this.BatM5);
                this.trackennemie(this.BatM6);
                this.trackennemie(this.BatM7);
                this.trackennemie(this.BatM8);
                this.trackennemie(this.BatM9);
                this.trackennemie(this.BatM10);
                this.trackennemie(this.BatM11);

                this.AgroZoneM1.x=this.PierreM1.x;
                this.AgroZoneM1.y=this.PierreM1.y;
                this.AgroZoneM2.x=this.PierreM2.x;
                this.AgroZoneM2.y=this.PierreM2.y;
                this.AgroZoneM3.x=this.PierreM3.x;
                this.AgroZoneM3.y=this.PierreM3.y;
                this.AgroZoneM4.x=this.PierreM4.x;
                this.AgroZoneM4.y=this.PierreM4.y;
                this.AgroZoneM5.x=this.PierreM5.x;
                this.AgroZoneM5.y=this.PierreM5.y;
                this.AgroZoneM6.x=this.PierreM6.x;
                this.AgroZoneM6.y=this.PierreM6.y;
                this.AgroZoneM7.x=this.PierreM7.x;
                this.AgroZoneM7.y=this.PierreM7.y;
                this.AgroZoneM8.x=this.PierreM8.x;
                this.AgroZoneM8.y=this.PierreM8.y;
                this.AgroZoneM9.x=this.PierreM9.x;
                this.AgroZoneM9.y=this.PierreM9.y;

                //console.log(this.player.x,this.player.y)
                ///console.log(this.PierreM1.x,this.PierreM1.y,this.player.x,this.player.y)
                this.physics.add.overlap(this.player, this.AgroZoneM1, this.AttackM1, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM2, this.AttackM2, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM3, this.AttackM3, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM4, this.AttackM4, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM5, this.AttackM5, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM6, this.AttackM6, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM7, this.AttackM7, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM8, this.AttackM8, null, this);
                this.physics.add.overlap(this.player, this.AgroZoneM9, this.AttackM9, null, this);

                if(this.invincible == true){
                    this.compteur-- ;
                if(this.compteur == 0){
                    this.compteur = 60;
                    this.player.setTint(0xffffff);                   //invincibilité avec compteur 
                    this.invincible = false ;
                    }
                }

                if(this.fallV==true && this.PotionStatus==4){
                    this.tailleP-=0.01
                    this.player.setScale(this.tailleP);
                    this.player.angle += 3;
                    this.player.alpha -= 0.01;
                    this.invincible=true;
                    if (this.tailleP<=0){
                        this.invincible=false;
                        this.MonstreAttaque()
                        if (this.player.direction=='gauche'){
                            this.player.x+=30
                        }
                        if (this.player.direction=='droite'){
                            this.player.x-=40
                        }
                         if (this.player.direction=='haut'){
                            this.player.y+=30
                        }
                         if (this.player.direction=='bas'){
                            this.player.y-=40
                        }
                        this.tailleP=1;
                        this.player.setScale(this.tailleP);
                        this.player.alpha=255;
                        this.fallV=false;
                        this.speedconst=140;
                        this.player.angle = 1;
                    }
                }
                
                if(this.fallV==true && this.PotionStatus>=1 && this.PotionStatus!=4){
                    this.potionCheck=true;
                    this.tailleP-=0.01
                        this.player.setScale(this.tailleP);
                        this.player.angle += 3;
                        this.player.alpha -= 0.01;
                    if (this.tailleP<=0){
                        if (this.player.direction=='gauche'){
                            this.player.x+=30
                        }
                        if (this.player.direction=='droite'){
                            this.player.x-=40
                        }
                        if (this.player.direction=='haut'){
                            this.player.y+=30
                        }
                        if (this.player.direction=='bas'){
                            this.player.y-=40
                        }
                        this.tailleP=1;
                        this.player.setScale(this.tailleP);
                        this.player.alpha=255;
                        this.fallV=false;
                        this.speedconst=140;
                        this.player.angle = 1;
                        this.PotionStatus+=1
                        this.PotionStatusHUD-=1
                    }
                }

                if(this.PotionStatus==3){
                    this.PotionStatus=4
                }

                if(this.keys.r.isDown){
                    this.haut="upF";
                    this.bas="downF";
                    this.droite="rightF";
                    this.gauche="leftF";
                    this.immobileB="staticFB";
                    this.immobileH="staticFH";
                    this.immobileG="staticFG";
                    this.immobileD="staticFD";
                    this.feuV=true;
                }
                if(this.feuV==true){
                    if (this.player.direction == 'gauche') { 
                        this.BulletA="BulletShootFG";
                    } 
                    else if (this.player.direction == 'droite'){ 
                        this.BulletA="BulletShootFD";
                    }
                    else if (this.player.direction == 'haut'){ 
                        this.BulletA="BulletShootFH";
                    }
                    else if (this.player.direction == 'bas'){ 
                        this.BulletA="BulletShootFB";
                    }
                }

                if(this.keys.e.isDown){
                    this.haut="upB";
                    this.bas="downB";
                    this.droite="rightB";
                    this.gauche="leftB";
                    this.immobileB="staticBB";
                    this.immobileH="staticBH";
                    this.immobileG="staticBG";
                    this.immobileD="staticBD";
                    this.BulletA="BulletShoot";
                    this.feuV=false;
                }

                //console.log(this.player.x,this.player.y)
                const {keys} = this
                this.speed = this.speedconst

                this.player.body.setVelocity(0)
                if(Phaser.Input.Keyboard.JustDown(this.keys.a)){
                    if (this.fallV==true){                  
                    }else{
                    this.tirer(this.player)
                    }
                }

                if ((this.cursors.left.isDown || this.keys.q.isDown) && this.fallV==false){
                    this.player.body.setVelocityX(-this.speed)
                    this.player.direction="gauche"

                }else if ((this.cursors.right.isDown || this.keys.d.isDown) && this.fallV==false){
                    this.player.body.setVelocityX(this.speed)
                    this.player.direction="droite"
                }
                else if ((this.cursors.up.isDown || this.keys.z.isDown) && this.fallV==false){
                    this.player.body.setVelocityY(-this.speed)
                    this.player.direction="haut"
                }else if ((this.cursors.down.isDown || this.keys.s.isDown) && this.fallV==false){                this.player.body.setVelocityY(this.speed)
                    this.player.direction="bas"
                }            

                this.player.body.velocity.normalize().scale(this.speed)

                if (this.cursors.left.isDown || this.keys.q.isDown){
                    this.player.anims.play(this.gauche, true)

                }else if (this.cursors.right.isDown || this.keys.d.isDown){
                    this.player.anims.play(this.droite, true)
                }else if (this.cursors.up.isDown || this.keys.z.isDown){
                    this.player.anims.play(this.haut, true)
                }else if (this.cursors.down.isDown || this.keys.s.isDown){
                    this.player.anims.play(this.bas, true)
                } 
                else if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="gauche"){
                    this.player.anims.play(this.immobileG, true)
                }
                else if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="bas"){
                    this.player.anims.play(this.immobileB, true)
                }
                else if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="droite"){
                    this.player.anims.play(this.immobileD, true)
                }
                if(this.cursors.left.isUp && this.keys.q.isUp && this.cursors.right.isUp && this.keys.d.isUp && this.cursors.up.isUp  && this.keys.z.isUp && this.cursors.down.isUp && this.keys.s.isUp && this.player.direction=="haut"){
                    this.player.anims.play(this.immobileH, true)
                }

                this.input.gamepad.once('connected', function (pad) {
                            this.controller = this.pad1;                     //verif si la manette est branchée
                            this.isConnected = true; 
                        });

                if(this.isConnected){
                    this.player.setVelocityX(160* this.controller.leftStick.x);
                    this.player.setVelocityY(160* this.controller.leftStick.y);           // permet d'avoir un déplacement en 360
                        if (this.controller.leftStick.y < 0){
                            if(this.controller.A && AttaqueStatus==false) {      //deplacement manette
                            this.player.setVelocityY(-300-ResistenceN);
                            this.player.anims.play(haut, true);
                            }else{
                            this.player.setVelocityY(-100);
                            this.player.anims.play(haut, true);
                            }
                        } 
                        
                        else if (this.controller.leftStick.y > 0) { 
                            if(controller.A  && AttaqueStatus==false) {
                            this.player.setVelocityY(300-ResistenceP);
                            this.player.anims.play(bas, true);
                            }else{
                            this.player.setVelocityY(100);
                            this.player.anims.play(bas, true);
                            }
                        }
                
                        else if(this.controller.leftStick.x < 0){
                            if(this.controller.A  && AttaqueStatus==false) {
                                this.player.setVelocityX(-300-ResistenceN);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(gauche, true);
                                }else{
                                this.player.setVelocityX(-100);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(gauche, true);}
                        }
                        else if(this.controller.leftStick.x > 0){
                            if(this.controller.A  && AttaqueStatus==false) {
                                this.player.setVelocityX(300-ResistenceP);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(droite, true);
                            }else{
                                this.player.setVelocityX(100);
                                this.player.setVelocityY(0); 
                                this.player.anims.play(droite, true);
                            }
                        }
                        else{
                            this.player.setVelocityX(0);
                            this.player.anims.play(immobile, true); 
                        }
                }                    
                
                
            } 
        };

    


        var config = {
            type: Phaser.AUTO,
            width: 1280, height: 720,           //config de la fenetre et du niveau en generale
            physics: {      
            default: 'arcade',
            arcade: {
            debug: false,
            }},
            pixelArt: true,
            input:{gamepad:true},
            scene: [sceneExemple,sceneExemple2]
            };
        new Phaser.Game(config);

    </script>
</body>
</html>                               
